
<a name="readme-top"></a>

<div align="center">

<img height="60" src="https://github.com/VectorZhao/deepexo/blob/master/docs/icon-512%402x.png">
<img height="60" src="https://github.com/VectorZhao/deepexo/blob/master/docs/icon-512%402x-colorful.png">

<h1 align="center">DeepExo</h1>

<b> ä¸€é”®æ­å¼€ç³»å¤–è¡Œæ˜Ÿå†…éƒ¨ä¹‹è°œ </b>ï¼Œ

ä¸€ä¸ªä¸ºè¡Œæ˜Ÿç§‘å­¦æä¾›çš„ç»¼åˆæœºå™¨å­¦ä¹ å¹³å°ã€‚

</div>

## ğŸ‘‹ğŸ» æ¦‚è§ˆ
ä½¿ç”¨ PyTorch çš„æ··åˆå¯†åº¦ç½‘ç»œã€‚ä¸å…¶ä»– MDN å®ç°ç›¸æ¯”ï¼Œæ­¤é¡¹ç›®ä½¿ç”¨ L2 æ­£åˆ™åŒ–å’Œå…¶ä»–æŠ€æœ¯ï¼Œè€Œé dropout å±‚æ¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä½¿ç½‘ç»œåœ¨è®­ç»ƒæœŸé—´æ›´åŠ ç¨³å®šã€‚è¯¥é¡¹ç›®åŸºäºæˆ‘å¯¼å¸ˆçš„ [Rocky_Exoplanets_v2](https://github.com/VectorZhao/Rocky_Exoplanets_v2)
## âœ¨ ç‰¹æ€§
- ğŸŒ ç»Ÿä¸€é¡¹ç›®é›†åˆï¼šæˆ‘ä»¬å·²ç²¾å¿ƒæ•´åˆäº†æ—¨åœ¨é¢„æµ‹[æ°”æ€å·¨è¡Œæ˜Ÿ](https://github.com/VectorZhao/ExtrasolarGasGiants)å’Œ[å²©çŸ³ç³»å¤–è¡Œæ˜Ÿ](https://github.com/VectorZhao/Rocky_Exoplanets_v2)å†…éƒ¨ç»“æ„çš„é¢„å…ˆå‘å¸ƒçš„æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚
- ğŸ”§ å°–ç«¯ä»£ç åº“ï¼šæˆ‘ä»¬çš„é¡¹ç›®ç»å†äº†å…¨é¢æ”¹é€ ï¼Œå®ç°äº†é‡‡ç”¨ PyTorch çš„é‡æ–°è®¾è®¡çš„ä»£ç æ¶æ„ã€‚è¿™æ¬¡æ”¹é©åŒ…æ‹¬å¯¹åƒ MDN å±‚è¿™æ ·çš„æ ¸å¿ƒç»„ä»¶çš„é‡æ–°æ„æƒ³ï¼Œä½¿æ¡†æ¶æ›´åŠ é«˜æ•ˆå’Œå¯æ‰©å±•ã€‚
- ğŸ“ˆ å“è¶Šçš„é¢„æµ‹æ€§èƒ½ï¼šåˆ©ç”¨æˆ‘ä»¬æ”¹è¿›åçš„ä»£ç åº“å’Œé‡æ–°è®­ç»ƒçš„ MDN æ¨¡å‹ï¼Œæˆ‘ä»¬åœ¨é¢„æµ‹èƒ½åŠ›ä¸Šå–å¾—äº†å®è´¨æ€§çš„å¢å¼ºã€‚æˆ‘ä»¬çš„æ¨¡å‹ä¸€è´¯æ˜¾ç¤ºå‡ºä¼˜äºå‰ä»£æ¨¡å‹çš„å“è¶Šæ€§èƒ½ï¼Œä¸ºè¡Œæ˜Ÿç§‘å­¦ç ”ç©¶æä¾›æ›´å‡†ç¡®å’Œå¯é çš„ç»“æœã€‚
- ğŸ§© å°è£…åŠŸèƒ½ï¼šä¸ºäº†ä¾¿äºç§‘å­¦ç•Œçš„ç ”ç©¶ï¼Œæˆ‘ä»¬å¼€å‘äº†ç”¨æˆ·å‹å¥½çš„å°è£…åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä½¿ç ”ç©¶äººå‘˜èƒ½å¤Ÿè½»æ¾å¯åŠ¨å’Œè®­ç»ƒè‡ªå·±ç”¨äºæ¢ç´¢ç³»å¤–è¡Œæ˜Ÿå†…éƒ¨çš„æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚è¿™ç§æŠ½è±¡åŒ–ç®€åŒ–äº†æ¨¡å‹å¼€å‘çš„å¤æ‚æ€§ï¼ŒåŠ é€Ÿäº†ç§‘å­¦æ¢ç´¢ã€‚

## ğŸš€ å¼€å§‹ä½¿ç”¨

## ä½¿ç”¨æ–¹æ³•

è¯·è®¿é—® [tortreinador](https://github.com/ArdenteX/tortreinador)

## ç»“æ„
1. è¯¥é¡¹ç›®åœ¨ sigma å±‚ä½¿ç”¨ Elu æ¿€æ´»å‡½æ•°ä»¥å¤„ç†æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸é—®é¢˜ï¼ŒåŒæ—¶æ¯”ä¼ ç»Ÿæ¿€æ´»å‡½æ•°å¯¹å™ªå£°æ›´åŠ é²æ£’ã€‚
    ```python
        self.root_layer = nn.Sequential(
            nn.Linear(self.i_s, self.n_h),
            nn.SiLU(),
            nn.Linear(self.n_h, self.n_h),
            nn.SiLU(),
            nn.Linear(self.n_h, self.n_h),
            nn.SiLU()
        ).double()
        
        self.pi = nn.Sequential(
            nn.Linear(self.n_h, self.n_h),
            nn.SiLU(),
            nn.Linear(self.n_h, self.n_g)
        ).double()
        
        self.mu = nn.Sequential(
            nn.Linear(self.n_h, self.n_h),
            nn.SiLU(),
            nn.Linear(self.n_h, self.o_s * self.n_g)
        ).double()
        
        self.sigma = nn.Sequential(
            nn.Linear(self.n_h, self.n_h),
            nn.ELU(),
            nn.Linear(self.n_h, self.o_s * self.n_g)
        ).double()
    ```
2. è¯¥é¡¹ç›®åº”ç”¨ L2 æ­£åˆ™åŒ–å’Œä¸€äº›æŠ€æœ¯ï¼Œæ¯”å¦‚ Xavier åˆå§‹åŒ–ï¼Œçƒ­èº«ï¼ˆwarmupï¼‰ç­‰ï¼Œä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚
    ```python
        # Xavier åˆå§‹åŒ–
        init_weights(model)
        model = nn.DataParallel(model)
        model.to(self.device)\
        
        # L2
        optimizer = torch.optim.Adam(split_weights(model), lr=self.lr, weight_decay=self.w_d)
        
        # çƒ­èº«
        warmup = WarmUpLR(optimizer, len(t_l) * 5)
    ```

## æ€§èƒ½
|                 | éšè—å±‚å¤§å° | é«˜æ–¯æ•°ç›® | æ‰¹é‡å¤§å° | å­¦ä¹ ç‡ | NLL æŸå¤±     | R2         | MSE        | é€Ÿåº¦ï¼ˆEpochï¼‰    |
|:----------------|:------------|:-------------------|:-----------|:--------------|:-------------|:-----------|:-----------|:-----------------|
| æ—  Dropout | 256         | 10                 | 1024       | 0.0001984     | **-33.7150** | **0.9950** | **0.0002** | **79**           |
| æœ‰ Dropout     | 512         | 20                 | 512        | 0.0001        | -25.1895     | 0.9929     | 0.0003     | 120              |


- é€Ÿåº¦ï¼ˆEpochï¼‰ï¼šå› ä¸ºæ—  Dropout MDN çš„æœ€ç»ˆæ€§èƒ½æ¯”å¦ä¸€ä¸ªæ›´å¥½ï¼Œè®°å½•ä¸‹æ¯ä¸ªæ¨¡å‹ R2 è¾¾åˆ° 0.9929 æ—¶çš„ Epoch æ•°ï¼Œå¯ä»¥æ¯”è¾ƒæ—  Dropout å’Œæœ‰ Dropout çš„ MDN è®­ç»ƒé€Ÿåº¦ã€‚

è´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°ï¼ˆæœ‰ Dropoutï¼‰
![img](Rock/Imgs/MDN_MRCk2_loss_20230524.png)

è´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°ï¼ˆæ—  Dropoutï¼‰
![img](Rock/Imgs/MRCk2_MDN20231129_TrainValLoss.png)

æ¦‚ç‡å¯†åº¦åˆ†å¸ƒçƒ­å›¾ï¼ˆæœ‰ Dropoutï¼‰
![img](Rock/Imgs/img_2.png)

æ¦‚ç‡å¯†åº¦åˆ†å¸ƒçƒ­å›¾ï¼ˆæ—  Dropoutï¼‰
![img](Rock/Imgs/prediction_MRCk2_20231201.png)

## ç¤ºä¾‹
è¯¥é¡¹ç›®çš„è®­ç»ƒéƒ¨åˆ†åŸºäºæ¨¡å— [tortreinador](https://github.com/ArdenteX/tortreinador)ã€‚

```python
from tortreinador import train
from tortreinador.models.MDN import mdn, Mixture, NLLLoss
import torch

input_parameters = [
    'Mass',
    'Radius',
    'Fe_(Mg+Si)',
    'k2',
]


output_parameters = [
    'WRF',
    'MRF',
    'CRF',
    'CMF',
    'PRS_CMB',
    'TEP_CMB',
]

# df_all æ˜¯ä½ çš„æ•°æ®é›†

trainer = train.TorchTrainer()
# æ¨¡å‹
model = mdn(len(input_parameters), len(output_parameters), 10, 256)

# æŸå¤±å‡½æ•°
criterion = NLLLoss()
pdf = Mixture()

# ä¼˜åŒ–å™¨
optim = torch.optim.Adam(trainer.xavier_init(model), lr=0.0001984, weight_decay=0.001)

# ä½ å¯ä»¥æŒ‡å®šè¾“å…¥/è¾“å‡ºå‚æ•°å’Œä½ çš„æ•°æ®é›†ï¼ˆå½“å‰ä»…æ”¯æŒ Dataframeï¼‰
t_loader, v_loader, test_x, test_y, s_x, s_y = trainer.load_data(data=df_all, input_parameters=input_parameters,
                                                                 output_parameters=output_parameters,
                                                                 if_normal=True, if_shuffle=True)

# é»˜è®¤çš„ä¼˜åŒ–å™¨æ˜¯ Adam
t_l, v_l, val_r2, train_r2, mse = trainer.fit_for_MDN(
    t_loader, v_loader, criterion, model=model, mixture=pdf,
    model_save_path='D:\\Resource\\MDN\\', optim=optim, best_r2=0.5)
```

## ğŸ“š References
- [Machine learning techniques in studies of the interior structure of rocky exoplanets](https://www.aanda.org/articles/aa/abs/2021/06/aa40375-21/aa40375-21.html)
- [Understanding the interior structure of gaseous giant exoplanets with machine learning techniques](https://www.aanda.org/articles/aa/abs/2022/02/aa42874-21/aa42874-21.html)
- [Machine-learning Inferences of the Interior Structure of Rocky Exoplanets from Bulk Observational Constraints](https://iopscience.iop.org/article/10.3847/1538-4365/acf31a)
